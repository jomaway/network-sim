import{d as Ce,o as h,c as u,a as i,b as f,w as F,u as d,R as se,n as J,e as D,f as ee,g as Re,F as E,r as Ie,h as ke,i as C,j as ze,t as P,k as K,l as T,v as O,m as V,p as Ne,q as B,s as Le,x as He,y as he,z as Te,A as Fe,B as xe,C as be,D as Ee,E as Be,G as Oe,H as Ve,I as Ue,J as We,K as qe,L as je,M as Ke}from"./vendor.5fd544b7.js";const Ge=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}};Ge();const ae=Ce({id:"layout",state:()=>({sidebar:!1,dark:!1,fullscreen:!1}),getters:{isSidebarOpen:s=>s.sidebar,isFullScreen:s=>s.fullscreen,isDark:s=>s.dark},actions:{closeSidebar(){this.isSidebarOpen=!1},openSidebar(){this.isSidebarOpen=!0},toggleSidebar(){this.sidebar=!this.sidebar}}});var z=(s,e)=>{const t=s.__vccOpts||s;for(const[n,o]of e)t[n]=o;return t};const Xe={},Je={xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"currentColor"},Ye=i("path",{d:"M10 3.22l-.61-.6a5.5 5.5 0 0 0-7.666.105 5.5 5.5 0 0 0-.114 7.665L10 18.78l8.39-8.4a5.5 5.5 0 0 0-.114-7.665 5.5 5.5 0 0 0-7.666-.105l-.61.61z"},null,-1),Qe=[Ye];function Ze(s,e){return h(),u("svg",Je,Qe)}var et=z(Xe,[["render",Ze]]);const tt={},st={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":"true",role:"img",class:"iconify iconify--mdi",width:"24",height:"24",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 20 20",fill:"currentColor"},nt=i("path",{d:"M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"},null,-1),ot=[nt];function rt(s,e){return h(),u("svg",st,ot)}var it=z(tt,[["render",rt]]);const at={},lt={xmlns:"http://www.w3.org/2000/svg",width:"20",height:"17",fill:"currentColor"},ct=i("path",{d:"M11 2.253a1 1 0 1 0-2 0h2zm-2 13a1 1 0 1 0 2 0H9zm.447-12.167a1 1 0 1 0 1.107-1.666L9.447 3.086zM1 2.253L.447 1.42A1 1 0 0 0 0 2.253h1zm0 13H0a1 1 0 0 0 1.553.833L1 15.253zm8.447.833a1 1 0 1 0 1.107-1.666l-1.107 1.666zm0-14.666a1 1 0 1 0 1.107 1.666L9.447 1.42zM19 2.253h1a1 1 0 0 0-.447-.833L19 2.253zm0 13l-.553.833A1 1 0 0 0 20 15.253h-1zm-9.553-.833a1 1 0 1 0 1.107 1.666L9.447 14.42zM9 2.253v13h2v-13H9zm1.553-.833C9.203.523 7.42 0 5.5 0v2c1.572 0 2.961.431 3.947 1.086l1.107-1.666zM5.5 0C3.58 0 1.797.523.447 1.42l1.107 1.666C2.539 2.431 3.928 2 5.5 2V0zM0 2.253v13h2v-13H0zm1.553 13.833C2.539 15.431 3.928 15 5.5 15v-2c-1.92 0-3.703.523-5.053 1.42l1.107 1.666zM5.5 15c1.572 0 2.961.431 3.947 1.086l1.107-1.666C9.203 13.523 7.42 13 5.5 13v2zm5.053-11.914C11.539 2.431 12.928 2 14.5 2V0c-1.92 0-3.703.523-5.053 1.42l1.107 1.666zM14.5 2c1.573 0 2.961.431 3.947 1.086l1.107-1.666C18.203.523 16.421 0 14.5 0v2zm3.5.253v13h2v-13h-2zm1.553 12.167C18.203 13.523 16.421 13 14.5 13v2c1.573 0 2.961.431 3.947 1.086l1.107-1.666zM14.5 13c-1.92 0-3.703.523-5.053 1.42l1.107 1.666C11.539 15.431 12.928 15 14.5 15v-2z"},null,-1),dt=[ct];function ht(s,e){return h(),u("svg",lt,dt)}var ut=z(at,[["render",ht]]);const pt={class:"overflow-y-auto py-4 px-3"},gt={class:"space-y-2"},mt=i("span",{class:"ml-3"},"Tutorial",-1),ft=i("span",{class:"ml-3"},"Network",-1),vt=i("div",{class:"devider"},null,-1),wt=i("span",{class:"ml-3"},"About",-1),_t={setup(s){const e=ae();return(t,n)=>(h(),u("aside",{class:J(["w-60 fixed top-0 left-0 h-screen z-20 rounded transition-position bg-red-400 dark:bg-gray-800 pt-14 hidden",[d(e).isSidebarOpen?"md:block":"hidden"]]),"aria-label":"Sidebar"},[i("div",pt,[i("ul",gt,[i("li",null,[f(d(se),{to:"/tutorial",class:"flex items-center p-2 text-base font-normal text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700"},{default:F(()=>[f(et,{class:"flex-shrink-0 text-gray-500 transition duration-75 dark:text-gray-400 group-hover:text-gray-900 dark:group-hover:text-white"}),mt]),_:1})]),i("li",null,[f(d(se),{to:"/network",class:"flex items-center p-2 text-base font-normal text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700"},{default:F(()=>[f(it,{class:"flex-shrink-0 text-gray-500 transition duration-75 dark:text-gray-400 group-hover:text-gray-900 dark:group-hover:text-white"}),ft]),_:1})]),vt,i("li",null,[f(d(se),{to:"/about",class:"flex items-center p-2 text-base font-normal text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700"},{default:F(()=>[f(ut,{class:"flex-shrink-0 text-gray-500 transition duration-75 dark:text-gray-400 group-hover:text-gray-900 dark:group-hover:text-white"}),wt]),_:1})])])])],2))}},yt={},Ct={xmlns:"http://www.w3.org/2000/svg",width:"18",height:"20",fill:"currentColor"},It=i("path",{d:"M11.447 8.894a1 1 0 1 0-.894-1.789l.894 1.789zm-2.894-.789a1 1 0 1 0 .894 1.789l-.894-1.789zm0 1.789a1 1 0 1 0 .894-1.789l-.894 1.789zM7.447 7.106a1 1 0 1 0-.894 1.789l.894-1.789zM10 9a1 1 0 1 0-2 0h2zm-2 2.5a1 1 0 1 0 2 0H8zm9.447-5.606a1 1 0 1 0-.894-1.789l.894 1.789zm-2.894-.789a1 1 0 1 0 .894 1.789l-.894-1.789zm2 .789a1 1 0 1 0 .894-1.789l-.894 1.789zm-1.106-2.789a1 1 0 1 0-.894 1.789l.894-1.789zM18 5a1 1 0 1 0-2 0h2zm-2 2.5a1 1 0 1 0 2 0h-2zm-5.447-4.606a1 1 0 1 0 .894-1.789l-.894 1.789zM9 1l.447-.894a1 1 0 0 0-.894 0L9 1zm-2.447.106a1 1 0 1 0 .894 1.789l-.894-1.789zm-6 3a1 1 0 1 0 .894 1.789L.553 4.106zm2.894.789a1 1 0 1 0-.894-1.789l.894 1.789zm-2-.789a1 1 0 1 0-.894 1.789l.894-1.789zm1.106 2.789a1 1 0 1 0 .894-1.789l-.894 1.789zM2 5a1 1 0 1 0-2 0h2zM0 7.5a1 1 0 1 0 2 0H0zm8.553 12.394a1 1 0 1 0 .894-1.789l-.894 1.789zm-1.106-2.789a1 1 0 1 0-.894 1.789l.894-1.789zm1.106 1a1 1 0 1 0 .894 1.789l-.894-1.789zm2.894.789a1 1 0 1 0-.894-1.789l.894 1.789zM8 19a1 1 0 1 0 2 0H8zm2-2.5a1 1 0 1 0-2 0h2zm-7.447.394a1 1 0 1 0 .894-1.789l-.894 1.789zM1 15H0a1 1 0 0 0 .553.894L1 15zm1-2.5a1 1 0 1 0-2 0h2zm12.553 2.606a1 1 0 1 0 .894 1.789l-.894-1.789zM17 15l.447.894A1 1 0 0 0 18 15h-1zm1-2.5a1 1 0 1 0-2 0h2zm-7.447-5.394l-2 1 .894 1.789 2-1-.894-1.789zm-1.106 1l-2-1-.894 1.789 2 1 .894-1.789zM8 9v2.5h2V9H8zm8.553-4.894l-2 1 .894 1.789 2-1-.894-1.789zm.894 0l-2-1-.894 1.789 2 1 .894-1.789zM16 5v2.5h2V5h-2zm-4.553-3.894l-2-1-.894 1.789 2 1 .894-1.789zm-2.894-1l-2 1 .894 1.789 2-1L8.553.106zM1.447 5.894l2-1-.894-1.789-2 1 .894 1.789zm-.894 0l2 1 .894-1.789-2-1-.894 1.789zM0 5v2.5h2V5H0zm9.447 13.106l-2-1-.894 1.789 2 1 .894-1.789zm0 1.789l2-1-.894-1.789-2 1 .894 1.789zM10 19v-2.5H8V19h2zm-6.553-3.894l-2-1-.894 1.789 2 1 .894-1.789zM2 15v-2.5H0V15h2zm13.447 1.894l2-1-.894-1.789-2 1 .894 1.789zM18 15v-2.5h-2V15h2z"},null,-1),kt=[It];function Nt(s,e){return h(),u("svg",Ct,kt)}var xt=z(yt,[["render",Nt]]);const bt={},At={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"currentColor"},St=i("path",{d:"M0 0h24v24H0z",fill:"none"},null,-1),Mt=i("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"},null,-1),$t=[St,Mt];function Dt(s,e){return h(),u("svg",At,$t)}var Pt=z(bt,[["render",Dt]]);const Rt={setup(s){const e=ae(),t=D(()=>e.isSidebarOpen);return(n,o)=>(h(),u("button",{class:J([d(t)?"bg-amber-400":"","rounded"]),onClick:o[0]||(o[0]=(...r)=>d(e).toggleSidebar&&d(e).toggleSidebar(...r))},[f(Pt)],2))}},zt={class:"fixed top-0 h-10 z-30 w-full overflow-hidden flex items-center justify-between bg-white dark:bg-gray-800 text-gray-700 border-b border-gray-200"},Lt={class:"flex w-full md:w-60 h-full bg-gray-50 dark:bg-gray-800 px-6 items-center"},Ht=i("p",{class:"font-bold text-amber-500 ml-2"},[ee("network-"),i("b",null,"sim")],-1),Tt={class:"hidden md:block md:flex md:justify-between md:bg-transparent px-2"},Ft={setup(s){return(e,t)=>(h(),u("nav",zt,[i("div",Lt,[f(xt),Ht]),i("div",Tt,[f(Rt)])]))}},Et={setup(s){const e=ae();return(t,n)=>(h(),u(E,null,[f(Ft),f(_t),i("main",{class:J(["pt-10",d(e).isSidebarOpen?"md:ml-60":""])},[f(d(Re))],2)],64))}},Bt="modulepreload",ue={},Ot="/network-sim/",pe=function(e,t){return!t||t.length===0?e():Promise.all(t.map(n=>{if(n=`${Ot}${n}`,n in ue)return;ue[n]=!0;const o=n.endsWith(".css"),r=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${n}"]${r}`))return;const a=document.createElement("link");if(a.rel=o?"stylesheet":Bt,o||(a.as="script",a.crossOrigin=""),a.href=n,document.head.appendChild(a),o)return new Promise((g,p)=>{a.addEventListener("load",g),a.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e())},Vt={},Ut={class:"px-0 md:px-4 py-4"};function Wt(s,e){return h(),u("section",Ut,[Ie(s.$slots,"default")])}var qt=z(Vt,[["render",Wt]]),I=(s=>(s[s.MSG=0]="MSG",s[s.ICMP=1]="ICMP",s[s.DHCPClient=2]="DHCPClient",s[s.DHCPServer=3]="DHCPServer",s))(I||{}),j=(s=>(s[s.idle=0]="idle",s[s.pending=1]="pending",s[s.error=2]="error",s))(j||{});const ne="FF-FF-FF-FF-FF-FF";var $=(s=>(s.IPv4="IPv4",s.ARP="ARP",s))($||{});class U{constructor(e,t,n,o){this.src=e,this.dst=t,this.type=n,this.payload=o}stringify(){return`Frame: 
  src: ${this.src} 
  dst: ${this.dst} 
  type: ${this.type==="IPv4"?"IPv4":"ARP"}`}getTypeLabel(){if(this.type==="IPv4")switch(this.payload.sID){case I.ICMP:return"ICMP";case I.DHCPClient:return"DHCP";case I.DHCPServer:return"DHCP";default:return"MSG"}else return this.type}}class oe{constructor(e,t){this.id=e,this.owner=t,this.link=null}connect(e){this.link=e}disconnect(){this.link=null}isConnected(){return this.link!==null}tx(e){if(this.isConnected())this.link.transfer(this,e);else throw new Error(`${this.id}: No link connected`)}rx(e){this.owner.receive(this,e)}getNodeID(){return this.owner.getNodeID()}}class ge extends oe{constructor(e,t,n){super(t,n);this.macAddr=e}rx(e){(e.dst===this.macAddr||ne===e.dst)&&this.owner.receive(this,e)}getMacAddr(){return this.macAddr}}function le(s){return new Promise(e=>setTimeout(e,s))}var ce=(s=>(s[s.Unknown=0]="Unknown",s[s.LinkActive=1]="LinkActive",s[s.HandlePacket=2]="HandlePacket",s[s.BeforeTransmit=3]="BeforeTransmit",s))(ce||{});class jt{constructor(){this.simulationTimeout=1e3,this.pauseTraffic=!1,this.intervalID=null,this.ticks=0,this.timers=[],this.logs=[]}init(){this.debug("Init TrafficManager"),this.intervalID=setInterval(()=>this.tick(),this.simulationTimeout)}async notify(e,t){if(e===1){const n=this.ticks+1;for(;this.ticks<n;)await le(this.simulationTimeout)}else this.debug(`Event ${e} not handled`)}debug(e){console.warn("TM DEBUG: ",e)}log(e){this.logs.push(e),console.log("TM LOG: ",e)}tick(){this.pauseTraffic||this.ticks++,this.timers.forEach(e=>{e.t<=this.ticks&&(console.log("TM: call CB",e.id),e.cb(),this.removeTimer(e.id))})}setSimulationTimeout(e){this.simulationTimeout=e,clearInterval(this.intervalID),this.intervalID=setInterval(()=>this.tick(),this.simulationTimeout)}setTimer(e,t){const n=Date.now()+Math.random();return this.debug(`set Timer ${n}`),this.timers.push({id:n,t:this.ticks+t,cb:e}),n}removeTimer(e){this.debug(`remove Timer ${e}`);const t=this.timers.findIndex(n=>n.id===e);t>-1&&this.timers.splice(t,1)}pause(){this.pauseTraffic=!0}play(){this.pauseTraffic=!1}isPause(){return this.pauseTraffic}next(){this.ticks++}}const m=new jt;m.init();class te{constructor(e){this.id=e,this.connectors=[],this.drawable=null,this.tm=m}attachTrafficManager(e){this.tm=e}getNodeID(){return this.id}isNodeWithID(e){return this.id===e}addConnector(e){this.connectors.push(new oe(e!=null?e:`C#${this.id}-${this.connectors.length+1}`,this))}hasFreeConnector(){return this.connectors.filter(e=>!e.isConnected()).length>0}getFreeConnector(){for(const e of this.connectors)if(!e.isConnected())return e;return null}getConnectorByID(e){return this.connectors.find(t=>t.id===e)}getConnectorList(){return this.connectors.map(e=>e.id)}async transmit(e,t){var n;await((n=this.tm)==null?void 0:n.notify(ce.BeforeTransmit,this));try{e.tx(t)}catch(o){m.log(`Node ${this.getNodeID()} transmit error: ${o} Drop frame`)}}isHost(){return this.getNodeType()===N.Host}save(){let e={};return e.id=this.getNodeID(),e.type=this.getNodeType(),e.connectors=this.connectors.map(t=>t.id),e.drawable=this.drawable,e}load(e){this.id=e.id,e.connectors.forEach((t,n)=>{const o=new oe(t,this);this.connectors[n]=o}),this.drawable=e.drawable}}var N=(s=>(s[s.Switch=0]="Switch",s[s.Host=1]="Host",s[s.Router=2]="Router",s))(N||{});const Kt="00-00-00-00-00-00";class G{constructor(e,t,n,o,r){this.type=e,this.senderIP=t,this.targetIP=n,this.senderMAC=o,this.targetMAC=r}}class Gt{constructor(e){this.owner=e,this.arpCache=new Map,this.arpCounter=0,this.onResolve=null,this.arpCache.set("255.255.255.255",ne),this.pending=!1}setOnResolveCb(e){this.onResolve=e}reset(){this.arpCache.clear()}knows(e){return this.arpCache.has(e)}async resolve(e){if(this.knows(e))return this.arpCache.get(e);{this.pending&&(m.debug("ARP.resolve() busy. Wait for previous operation to finish"),await this.waitforResult(),m.debug("ARP.resolve() continue"));const t=this.owner;this.sendArpRequest(t.getMacAddr(),t.getIpAddr(),e,t.getDefaultNIC());const n=m.setTimer(()=>this.pending=!1,10);return await this.waitforResult(),m.removeTimer(n),this.arpCache.get(e)}}async waitforResult(){for(;this.pending;)await le(1e3)}sendArpRequest(e,t,n,o){m.log(`ARP:  Node ${this.owner.getNodeID()} send Request`);const r=new G("ARP-Request",t,n,e,Kt),a=new U(e,ne,$.ARP,r);this.owner.transmit(o,a),this.pending=!0}sendArpResponse(e,t,n,o,r){m.log(`ARP: Node ${this.owner.getNodeID()} send Response`);const a=new G("ARP-Response",n,o,e,t),g=new U(e,t,$.ARP,a);this.owner.transmit(r,g)}handleArpRequest(e,t,n,o){this.arpCache.set(e.senderIP,e.senderMAC),e.targetIP===n?(m.log(`ARP: Node ${this.owner.getNodeID()} received Request`),this.sendArpResponse(t,e.senderMAC,n,e.senderIP,o)):m.debug(`Drop: Node ${this.owner.getNodeID()} dropped ${JSON.stringify(e)}`)}handleArpResponse(e){var o;m.log(`ARP: Node ${this.owner.getNodeID()} received Response`);const t=e.senderMAC,n=e.senderIP;this.arpCache.set(n,t),this.pending=!1,(o=this.onResolve)==null||o.call(this,n,t)}handleArpPacket(e,t){e.type==="ARP-Request"?this.handleArpRequest(e,t.mac,t.ip,t.connector):this.handleArpResponse(e)}}class H{constructor(e,t,n,o){this.src=e,this.dst=t,this.sID=n,this.payload=o}}class de{constructor(e,t){this.color=e,this.shape=t,this.icon=null,this.pos={x:0,y:0}}}var Ae=(s=>(s.Server="#e74c3c",s.Host="#EF4444",s.Switch="#65A30D",s.Router="#14B8A6",s))(Ae||{}),re=(s=>(s.idle="#3498db",s.selected="",s.active="#e74c3c",s))(re||{});const me=Symbol("icmp-req"),fe=Symbol("icmp-res");class Xt{constructor(e){this.owner=e,this.pending=!1,this.result=null}getServiceID(){return I.ICMP}sendRequest(e){this.sendIcmpRequest(e)}async ping(e){this.sendIcmpRequest(e),this.result="pending";const t=m.setTimer(()=>this.result="error",10);for(;this.result==="pending";)await le(1e3);return m.removeTimer(t),this.result}handleIpPacket(e){e.payload===me.toString()?this.handleIcmpRequest(e):e.payload===fe.toString()?this.handleIcmpResponse(e):console.warn("No valid ICMP service packet")}sendIcmpRequest(e){m.log(`"ICMP:" ${this.owner.name} send ping request`);const t=new H(this.owner.getIpAddr(),e,I.ICMP,me.toString());this.owner.sendPacket(t)}sendIcmpResponse(e){m.log(`"ICMP:" ${this.owner.name} send ping response`);const t=new H(this.owner.getIpAddr(),e,I.ICMP,fe.toString());this.owner.sendPacket(t)}handleIcmpRequest(e){m.log(`"ICMP:" ${this.owner.name} rcv ping request`),this.sendIcmpResponse(e.src)}handleIcmpResponse(e){m.log(`"ICMP:" ${this.owner.name} rcv ping response`),this.result="success"}}class Se{constructor(){this.static=!0,this.addr="",this.snm="",this.gw="",this.dns=""}}const Me=Symbol("dhcp-discover"),$e=Symbol("dhcp-offer");class W{constructor(e){this.type=e,this.macAddr=null,this.ipConfig=null}setIpConfig(e){this.ipConfig=e}toString(){return JSON.stringify(this)}static fromString(e){const t=JSON.parse(e),n=new W(t.type);return n.macAddr=t.macAddr,n.ipConfig=t.ipConfig,n}}class Jt{constructor(e){this.owner=e,this.state=j.idle}getServiceID(){return I.DHCPClient}getState(){return this.state}sendDHCPDiscover(){m.log(`DHCP: ${this.owner.name} send ${Me.toString()}`);const e="0.0.0.0",t="255.255.255.255",n=new W(0);n.macAddr=this.owner.getMacAddr();const o=new H(e,t,I.DHCPServer,n.toString());this.owner.sendPacket(o),this.state=j.pending}sendDHCPRequest(e){}sendRequest(e){this.sendDHCPDiscover()}handleIpPacket(e){const t=W.fromString(e.payload);if(t.type=1){if(this.owner.getMacAddr()!==t.macAddr)return;m.log(`DHCP: ${this.owner.name} receive ${$e.toString()}`),this.owner.setIpConfig(t.ipConfig),this.state=j.idle}else m.log(`DHCP: ${this.owner.name} receive ${t.type}`)}}class De{constructor(e){this.owner=e,this.state=j.idle,this.conf={first:"10.13.201.100",last:"10.13.202.200",snm:"255.255.252.0",gw:"10.13.200.1",dns:"10.13.200.2"},this.inUse=[]}getServiceID(){return I.DHCPServer}getState(){return this.state}sendDHCPOffer(e){m.log(`DHCP: ${this.owner.name} send ${$e.toString()}`);const t=this.owner.getIpAddr(),n="255.255.255.255",o=new W(1);o.macAddr=e.macAddr,o.ipConfig=this.getFreeIpConf();const r=new H(t,n,I.DHCPClient,o.toString()),a=new U(this.owner.getMacAddr(),e.macAddr,$.IPv4,r);this.owner.sendFrame(a)}sendRequest(e){}handleIpPacket(e){const t=W.fromString(e.payload);t.type===0?(m.log(`DHCP: ${this.owner.name} receive ${Me.toString()}`),this.sendDHCPOffer(t)):m.log(`DHCP: ${this.owner.name} receive ${t.type}`)}getFreeIpConf(){const e=new Se;return e.static=!1,e.addr=this.getFreeIpAddr(),e.snm=this.conf.snm,e.gw=this.conf.gw,e.dns=this.conf.dns,e}getFreeIpAddr(){const e="10.13.200.X".replace(/X/g,()=>(Math.floor(Math.random()*150)+100).toString());return this.inUse.includes(e)?this.getFreeIpAddr():(this.inUse.push(e),e)}}class ie extends te{constructor(e,t){super(e);this.name=t,this.ipConfig=new Map,this.addNIC(),this.arpService=new Gt(this),this.tts=0,this.drawable=new de("#EF4444","circle"),this.services=new Map,this.registerService(new Xt(this)),this.registerService(new Jt(this))}addNIC(e){const t=_e(),n=e!=null?e:`eth${this.connectors.length}`;this.connectors.push(new ge(t,n,this)),this.ipConfig.set(n,new Se)}getDefaultNIC(){return this.connectors[0]}getNICByID(e){return this.getConnectorByID(e)}getMacAddr(e){return e?this.getNICByID(e).getMacAddr():this.getDefaultNIC().getMacAddr()}getIpConfig(e){return this.ipConfig.get(e!=null?e:this.getDefaultNIC().id)}setIpConfig(e,t){this.ipConfig.set(t!=null?t:this.getDefaultNIC().id,e)}getCIDR(e){const t=this.getIpConfig(e).addr,n=this.getIpConfig(e).snm.split(".").map(o=>{switch(parseInt(o)){case 255:return 8;case 254:return 7;case 252:return 6;case 248:return 5;case 240:return 4;case 224:return 3;case 192:return 2;case 128:return 1;default:return 0}}).reduce((o,r)=>o+r,0);return`${t} /${n}`}getIpAddr(e){return this.getIpConfig(e).addr}getSubnetmask(e){return this.getIpConfig(e).snm}getGateway(e){return this.getIpConfig(e).gw}getDns(e){return this.getIpConfig(e).dns}setIpAddr(e,t){this.getIpConfig(t).addr=e}setSubnetmask(e,t){this.getIpConfig(t).snm=e}setGateway(e,t){this.getIpConfig(t).gw=e}setDns(e,t){this.getIpConfig(t).dns=e}registerService(e){this.services.has(e.getServiceID())&&console.warn("overwrite service ",e.getServiceID(),"on node",this.getNodeID()),this.services.set(e.getServiceID(),e)}useService(e){return this.services.get(e)}hasService(e){return this.services.has(e)}receive(e,t){t.type===$.ARP?t.payload instanceof G&&this.arpService.handleArpPacket(t.payload,{connector:e,mac:this.getMacAddr(),ip:this.getIpAddr()}):t.payload instanceof H&&this.handleIpPacket(t.payload,e.id)}handleIpPacket(e,t){var n,o;this.hasService(e.sID)?(n=this.useService(e.sID))==null||n.handleIpPacket(e):(o=this.tm)==null||o.log(`Unknown SID: ${e.sID}`)}sendFrame(e){this.transmit(this.getDefaultNIC(),e)}isIpBroadcast(e){return e==="255.255.255.255"}isSameNetwork(e){const t=this.getSubnetmask().split(".").map(r=>parseInt(r)),n=this.getIpAddr().split(".").map((r,a)=>parseInt(r)&t[a]).join("."),o=e.split(".").map((r,a)=>parseInt(r)&t[a]).join(".");return n===o}async sendPacket(e){var r,a;let t=e.dst;!this.isSameNetwork(t)&&!this.isIpBroadcast(t)&&((r=this.tm)==null||r.log("Destination not in the same network"),t=this.getGateway());const n=await this.arpService.resolve(t);if(!n){(a=this.tm)==null||a.log(`Could not resolve the mac for ip ${t} Packet will be droped`);return}const o=new U(this.getMacAddr(),n,$.IPv4,e);this.sendFrame(o)}sendMsg(e,t){const n=new H(this.getIpAddr(),t.getIpAddr(),I.MSG,e);this.sendPacket(n)}notify(e){console.log("notify",e)}getName(){return this.name}setName(e){this.name=e}getNodeType(){return N.Host}ping(e){return this.useService(I.ICMP).ping(e)}getDynamicIpConfig(){this.useService(I.DHCPClient).sendRequest()}save(){let e=super.save();return e.name=this.name,e.ipConfig=Array.from(this.ipConfig,([t,n])=>({name:t,value:n})),e.services=[],this.services.forEach(t=>e.services.push(t.getServiceID())),e}load(e){super.load(e),this.name=e.name,e.ipConfig.forEach(t=>{this.ipConfig.set(t.name,t.value)}),e.connectors.forEach((t,n)=>{const o=new ge(_e(),t,this);this.connectors[n]=o}),e.services.forEach(t=>{switch(t){case I.ICMP:break;case I.DHCPClient:break;case I.DHCPServer:this.registerService(new De(this));break;default:console.warn("unknown service ID",t);break}})}}class ve extends te{constructor(e,t){super(e);this.name=`Switch-${t}`,this.portCount=t,this.macTable=new Map;for(let n=0;n<t;n++)this.addConnector();this.drawable=new de("#65A30D","rect")}receive(e,t){t.src!=="FF-FF-FF-FF-FF-FF"&&this.addtoMacTable(e.id,t.src);const n=this.lookupMac(t.dst);n?this.connectors.find(o=>o.id===n).tx(t):this.connectors.filter(o=>o.isConnected()).forEach(o=>{o!==e&&o.tx(t)})}addtoMacTable(e,t){this.macTable.has(e)?this.macTable.set(e,[...new Set([t,...this.macTable.get(e)])]):this.macTable.set(e,[t])}lookupMac(e){for(const[t,n]of this.macTable)if(n.includes(e))return t;return null}getName(){return this.name}setName(e){this.name=e}getNodeType(){return N.Switch}save(){let e=super.save();return e.name=this.name,e.portCount=this.portCount,e}load(e){super.load(e)}}class we extends ie{constructor(e){super(e,`Router-${e}`);this.connectors.length=0,this.addNIC("LAN"),this.addNIC("WAN"),this.drawable=new de("#14B8A6","rect")}registerService(e){this.services.set(e.getServiceID(),e)}useService(e){return this.services.get(e)}hasService(e){return this.services.has(e)}getName(){return this.name}setName(e){this.name=e}getNodeType(){return N.Router}receive(e,t){e.id==="LAN"?this.receiveOverLAN(t):e.id==="WAN"&&this.receiveOverWAN(t)}receiveOverLAN(e){var t;e.type===$.ARP?e.payload instanceof G&&this.arpService.handleArpPacket(e.payload,{connector:this.getConnectorByID("LAN"),mac:this.getMacAddr("LAN"),ip:(t=this.getLANConf())==null?void 0:t.addr}):this.getMacAddr("LAN")===e.dst&&e.payload instanceof H&&this.handleIpPacket(e.payload,"LAN")}receiveOverWAN(e){var t;e.type===$.ARP?e.payload instanceof G&&this.arpService.handleArpPacket(e.payload,{connector:this.getConnectorByID("WAN"),mac:this.getMacAddr("WAN"),ip:(t=this.getWANConf())==null?void 0:t.addr}):this.getMacAddr("WAN")===e.dst&&e.payload instanceof H&&this.handleIpPacket(e.payload,"WAN")}handleIpPacket(e,t){var o;(o=this.tm)==null||o.emit("NodeActive",`${this.name} rx packet over ${t}`);const n=this.performNAT(e);t==="LAN"?this.sendWAN(n):t==="WAN"&&this.sendLAN(n)}performNAT(e){return e}sendWAN(e){if(this.arpService.knows(e.dst)){const t=new U(this.getMacAddr("WAN"),this.arpService.resolve(e.dst),$.IPv4,e);this.transmit(this.getWANConnector(),t)}else this.arpService.sendArpRequest(this.getMacAddr("WAN"),this.getWANConf().addr,e.dst,this.getWANConnector()),this.arpService.setOnResolveCb(()=>{this.sendWAN(e)})}sendLAN(e){if(this.arpService.knows(e.dst)){const t=new U(this.getMacAddr("LAN"),this.arpService.resolve(e.dst),$.IPv4,e);this.transmit(this.getLANConnector(),t)}else this.arpService.sendArpRequest(this.getMacAddr("LAN"),this.getLANConf().addr,e.dst,this.getLANConnector()),this.arpService.setOnResolveCb(()=>{this.sendLAN(e)})}setLAN(e){this.ipConfig.set("LAN",e)}setWAN(e){this.ipConfig.set("WAN",e)}getLANConf(){return this.ipConfig.get("LAN")}getWANConf(){return this.ipConfig.get("WAN")}getLANConnector(){return this.getConnectorByID("LAN")}getWANConnector(){return this.getConnectorByID("WAN")}save(){let e=super.save();return e.name=this.name,e.lanMacAddr=this.getMacAddr("LAN"),e.wanMacAddr=this.getMacAddr("WAN"),e.lanipConfig=this.ipConfig.get("LAN"),e.wanipConfig=this.ipConfig.get("WAN"),e.services=[],this.services.forEach(t=>e.services.push(t.getServiceID())),e}load(e){super.load(e)}}class Yt{constructor(e,t,n){this.id=e,this.c1=t,this.c2=n,this.connect(),this.tm=m,this.active=!1,this.lastFrame=null}attachTrafficManager(e){this.tm=e}connect(){this.c1.connect(this),this.c2.connect(this)}disconnect(){this.c1.disconnect(),this.c2.disconnect()}swap(){const e=this.c1;this.c1=this.c2,this.c2=e}async transfer(e,t){e!==this.c1&&this.swap();const n=this.c2;this.active=!0,this.lastFrame=t,await this.tm.notify(ce.LinkActive,this),n.rx(t),this.active=!1}isActive(){this.active}}class Qt{constructor(){this.nodes=[],this.links=[],this.lastUsedID=0,this.tm=m}addNode(e){e.attachTrafficManager(this.tm),this.nodes.push(e)}removeNode(e){e.connectors.forEach(t=>{t.isConnected()&&this.removeLink(t.link)}),this.nodes.splice(this.nodes.indexOf(e),1)}removeNodeWithID(e){this.removeNode(this.getNodeByID(e))}addHost(e){const t=new ie(this.getNextID(),e);return this.addNode(t),t}addSwitch(e){const t=new ve(this.getNextID(),e);return this.addNode(t),t}addRouter(){const e=new we(this.getNextID());return this.addNode(e),e}addLink(e,t){const n=e.getFreeConnector(),o=t.getFreeConnector();if(n&&o){const r=new Yt(`l${this.getNextID()}`,n,o);this.links.push(r)}else throw new Error("Could not add link")}removeLink(e){e.disconnect(),this.links.splice(this.links.indexOf(e),1)}removeLinkWithID(e){this.removeLink(this.getLinkByID(e))}getNextID(){return++this.lastUsedID}getNodeByID(e){return typeof e=="string"&&(e=parseInt(e)),this.nodes.find(t=>t.id===e)}getHostByID(e){return this.getAllHosts().find(t=>t.id===e)}getLinkByID(e){return this.links.find(t=>t.id===e)}getAllFromType(e){return this.nodes.filter(t=>t.getNodeType()===e)}getAllHosts(){return this.getAllFromType(N.Host).map(e=>e)}randomIPs(){this.getAllHosts().forEach(t=>{const n="10.13.200."+Math.floor(Math.random()*255);t.setIpAddr(n)})}saveNetwork(){let e={};return e.lastUsedID=this.lastUsedID,e.nodes=this.nodes.map(t=>t.save()),e.links=this.links.map(t=>{let n={};return n.c1=t.c1.getNodeID(),n.c2=t.c2.getNodeID(),n}),JSON.stringify(e)}loadNetwork(e){this.nodes=[],this.links=[],this.lastUsedID=e.lastUsedID,e.nodes.forEach(t=>{let n=null;switch(t.type){case N.Host:n=new ie(t.id,t.name);break;case N.Switch:n=new ve(t.id,t.portCount);break;case N.Router:n=new we(t.id);break}n.load(t),this.addNode(n)}),e.links.forEach(t=>{const n=this.getNodeByID(t.c1),o=this.getNodeByID(t.c2);this.addLink(n,o)})}reset(){this.nodes=[],this.links=[],this.lastUsedID=0}}function _e(){return"XX:XX:XX:XX:XX:XX".replace(/X/g,()=>"0123456789ABCDEF".charAt(Math.floor(Math.random()*16)))}const X=Ce({id:"network",state:()=>({manager:new Qt,layouts:{nodes:{}},selected:{nodes:[],links:[]},nodeInfo:{show:!1,nodeID:-1},terminal:{show:!1,context:{nodeID:-1}}}),getters:{getNodes:s=>{let e={};return s.manager.nodes.forEach(t=>{e[t.id]={id:t.id,name:t.getName(),color:t.id==s.nodeInfo.nodeID&&s.nodeInfo.show?"#FFBF00":t.drawable.color,dType:t.drawable.shape}}),e},getEdges:s=>{let e={};return s.manager.links.forEach(t=>{e[t.id]={source:t.c1.getNodeID(),target:t.c2.getNodeID(),animate:t.active,srcmarker:t.c1.id==="WAN"?"circle":"none",tarmarker:t.c2.id==="WAN"?"circle":t.active?"arrow":"none"}}),e},getLayouts:s=>{let e={nodes:{}};return s.manager.nodes.forEach(t=>{e.nodes[t.id]=t.drawable.pos}),e},getActiveLinks:s=>s.manager.links.filter(e=>e.active),isNodeSelected:s=>s.selected.nodes.length!==0,getSelectedNode:s=>s.isNodeSelected?s.manager.getNodeByID(s.selected.nodes[0]):null,isTerminalVisible:s=>{var e;return s.terminal.show&&((e=s.manager.getNodeByID(s.terminal.context.nodeID))==null?void 0:e.getNodeType())===N.Host},getEditNode:s=>s.manager.getNodeByID(s.nodeInfo.nodeID),getFirstSelectedNode:s=>s.manager.getNodeByID(s.selected.nodes[0]),getHostList:s=>s.manager.getAllFromType(N.Host).map(e=>({id:e.id,name:e.name}))},actions:{moveNode(s,e){const t=this.manager.getNodeByID(s);t.drawable.pos=e},setTermCtxID(s){typeof s=="string"&&(s=parseInt(s)),this.terminal.context.nodeID=s},setEditNode(s){this.nodeInfo.nodeID=s,this.nodeInfo.show=!0},reset(){this.manager.reset(),this.$reset},updateLayoutForNode(s){this.layouts.nodes[s.id]=s.drawable.pos},saveNetwork(){localStorage.setItem("netsim-network-manager",this.manager.saveNetwork())},loadRecentNetwork(){localStorage["netsim-network-manager"]?(this.manager.loadNetwork(JSON.parse(localStorage.getItem("netsim-network-manager"))),this.manager.nodes.forEach(s=>{this.updateLayoutForNode(s)})):console.warn("No network found")},saveNetworkAsFile(){const s="network-sim_example.json",e=this.manager.saveNetwork(),t=URL.createObjectURL(new Blob([e],{type:"octet/stream"})),n=document.createElement("a");n.href=t,n.download=s,n.click(),window.URL.revokeObjectURL(t)},loadNetworkFromFile(s){console.log("try to load network from ",s);const e=new FileReader;e.onload=t=>{console.log("Reading file successfully"),this.manager.loadNetwork(t.target.result),this.saveNetwork()},e.readAsText(s)}}}),Zt={class:"flex flex-col gap-2 h-full w-full items-stretch"},es={class:"py-1 px-2 flex justify-between border-b border-gray-400"},ts={class:"font-bold text-white"},ss=i("p",{class:"px-4 font-bold text-white"},"x",-1),ns=[ss],os={class:"w-full px-2 pb-1"},rs=["onKeyup","disabled"],is={props:{node:{type:te,required:!0}},emits:["close"],setup(s,{emit:e}){const t=s;ke(()=>t.node,()=>{p.value=["$ logged in to terminal on node "+n.value+"."," Run help for a list of all available commands"],S.value.focus()});const n=D(()=>t.node.getName()),o=C(null),r=C(""),a=C(["ping 10.13.200.1"]),g=C(a.value.length),p=C([]),x=()=>{console.log("enter pressed. cmd= ",r.value),r.value!==""&&(a.value.includes(r.value)?a.value.push(a.value.splice(a.value.indexOf(r.value),1)[0]):a.value.push(r.value),g.value=a.value.length,_(r.value),r.value="",R())};async function _(b){var q;const w=b.split(" "),L=w[0],Q=(q=w[1])!=null?q:"";switch(L){case"help":p.value=["$ help","ip : show the own ip addr","ping : check if node is available"];break;case"ping":{p.value=[`$ ping ${Q} ...`];const Z=await t.node.ping(Q);p.value.push(Z);break}case"ip":p.value=["$ ip info",t.node.getIpConfig()];break;default:p.value=["Command not found: "+b];break}}const A=b=>{switch(b.key){case"ArrowUp":console.log("key ArrowUp pressed"),g.value=g.value>0?g.value-=1:0,r.value=a.value[g.value];break;case"ArrowDown":console.log("key ArrowDown pressed"),g.value=g.value<a.value.length-1?g.value+=1:a.value.length-1,r.value=a.value[g.value];break}},S=C();ze(()=>{p.value=[" Run help for a list of all available commands"],S.value.focus()});const R=()=>{o.value.lastElementChild.scrollIntoView()},M=()=>{e("close")};return(b,w)=>(h(),u("div",Zt,[i("div",es,[i("p",ts,"Host: "+P(d(n)),1),i("button",{onClick:M},ns)]),i("ul",{ref_key:"stdout",ref:o,class:"px-2 flex-grow overflow-hidden overflow-y-scroll text-white"},[(h(!0),u(E,null,K(p.value,L=>(h(),u("li",{key:L},P(L),1))),128))],512),i("div",os,[T(i("input",{ref_key:"stdinRef",ref:S,type:"text","onUpdate:modelValue":w[0]||(w[0]=L=>r.value=L),placeholder:"Type command",class:"w-full h-10 px-2 rounded bg-gray-600 text-gray-100 border-rose-600 focus:border-sky-500 focus:ring-sky-500 disabled:border-gray-600",onKeyup:[V(x,["enter"]),A],disabled:!s.node},null,40,rs),[[O,r.value]])])]))}},as={},ls={xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",role:"img",width:"24",height:"24",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:""},cs=i("polyline",{points:"9 18 15 12 9 6"},null,-1),ds=[cs];function hs(s,e){return h(),u("svg",ls,ds)}var us=z(as,[["render",hs]]);const ps={class:"min-h-8 min-w-20 bg-white rounded-md"},gs={class:"flex flex-col gap-1"},ms=["onClick"],fs={key:0,class:"block w-6 h-6 slide-out"},vs={key:0},Pe={props:{menuItems:Array,show:Boolean,level:{type:Number,default:0}},emits:["selected","close"],setup(s,{expose:e,emit:t}){const n=s,o=C(),r=C(null),a=D(()=>n.show&&r.value!==null),g=()=>{r.value=null};e({reset:g});const p=()=>{t("close"),g()},x=_=>{const A=n.menuItems.find(S=>S.name===_);A.items?r.value=A:(A.onSelect?A.onSelect():console.warn("No select handler found for",_),p())};return(_,A)=>{var R;const S=Ne("Menu",!0);return n.show?(h(),u("div",{key:0,ref_key:"menuRef",ref:o,class:"flex gap-1 items-start"},[i("div",ps,[i("ul",gs,[(h(!0),u(E,null,K(s.menuItems,M=>{var b;return h(),u("li",{key:M.name,class:J(["p-2 flex justify-between cursor-pointer hover:bg-amber-200 first:hover:rounded-t-md last:hover:rounded-b-md",((b=r.value)==null?void 0:b.name)==M.name?"bg-amber-200":""]),onClick:w=>x(M.name)},[ee(P(M.name)+" ",1),M.items?(h(),u("span",fs,[f(us)])):B("",!0)],10,ms)}),128))])]),d(a)?(h(),u("div",vs,[f(S,{show:!0,"menu-items":(R=r.value)==null?void 0:R.items,level:s.level+1,onClose:p},null,8,["menu-items","level"])])):B("",!0)],512)):B("",!0)}}},ws={props:{position:Object,items:Array},emits:["selected","close"],setup(s,{emit:e}){const t=s,n=D(()=>({top:t.position.y+"px",left:t.position.x+"px"})),o=()=>{e("close")};return(r,a)=>(h(),u("div",{class:"fixed rounded-md",style:Le(d(n))},[f(Pe,{"menu-items":s.items,show:!0,onClose:o},null,8,["menu-items"])],4))}},_s={},ys={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"currentColor",viewBox:"0 0 455 455"},Cs=i("path",{d:`M227.5,0C101.855,0,0,101.855,0,227.5S101.855,455,227.5,455S455,353.145,455,227.5S353.145,0,227.5,0z M117.5,262.5
	c-19.299,0-35-15.701-35-35s15.701-35,35-35s35,15.701,35,35S136.799,262.5,117.5,262.5z M227.5,262.5c-19.299,0-35-15.701-35-35
	s15.701-35,35-35c19.299,0,35,15.701,35,35S246.799,262.5,227.5,262.5z M337.5,262.5c-19.299,0-35-15.701-35-35s15.701-35,35-35
	s35,15.701,35,35S356.799,262.5,337.5,262.5z`},null,-1),Is=[Cs];function ks(s,e){return h(),u("svg",ys,Is)}var Ns=z(_s,[["render",ks]]);const xs={ref:"floatMenuWrapper",class:"absolute left-4 bottom-4 flex flex-col-reverse gap-4"},bs={ref:"menuButtonRef",class:"bg-amber-400 rounded-lg"},As={props:{menuItems:Array,position:Object},setup(s,{expose:e}){const t=C(),n=C(!1),o=()=>{n.value=!n.value},r=()=>{n.value=!1,t.value.reset()};return e({close:r}),(a,g)=>(h(),u("div",xs,[i("div",bs,[i("span",{class:"cursor-pointer",onClick:g[0]||(g[0]=p=>o())},[f(Ns,{fill:""})])],512),f(Pe,{ref_key:"menuRef",ref:t,"menu-items":s.menuItems,show:n.value,onClose:r},null,8,["menu-items","show"])],512))}},Ss=["x","y"],Ms=i("path",{d:"m0 0h20v14h-20zm1 1v12h18v-12zM0 0l10 7 10-7v1l-10 7-10-7z"},null,-1),$s={x:"10",y:"7","font-size":"0.5em","dominant-baseline":"central","text-anchor":"middle",fill:"#ff0000"},Ds=["x","y"],Ps=i("rect",{width:"100",height:"24",rx:"15",ry:"15",fill:"#aed6f1"},null,-1),Rs={x:100/2,y:24/2,"font-size":"12px","dominant-baseline":"central","text-anchor":"middle",fill:"#ffffff"},zs={props:{eventHandlers:Object},setup(s){const e=X(),t=He(),n=C(),o=C(1),r=D(()=>o.value===-1?!0:o.value),a=C(),g=C(),p=he({position:{x:50,y:10},show:!1,items:[]}),x=c=>{const l=c.event;l.stopPropagation(),l.preventDefault(),p.position.x=l.x,p.position.y=l.y,p.show=!0},_=c=>{x(c),p.items=M(c.node)},A=c=>{x(c);const l={x:c.event.x,y:c.event.y},y=n.value.translateFromDomToSvgCoordinates(l);p.items=R(y)},S=c=>{x(c),p.items=b(c.edge)},R=c=>[{name:"Add Host",onSelect:()=>{const l=e.manager.addHost("New Host");l.drawable.pos=c,e.updateLayoutForNode(l)}},{name:"Add Server",onSelect:()=>{const l=e.manager.addHost("Server");l.drawable.pos=c,l.drawable.color=Ae.Server,l.registerService(new De(l)),e.updateLayoutForNode(l)}},{name:"Add Switch",items:[{name:"5 Ports",onSelect:()=>{const l=e.manager.addSwitch(5);l.drawable.pos=c,e.updateLayoutForNode(l)}},{name:"8 Ports",onSelect:()=>{const l=e.manager.addSwitch(8);l.drawable.pos=c,e.updateLayoutForNode(l)}},{name:"16 Ports",onSelect:()=>{const l=e.manager.addSwitch(16);l.drawable.pos=c,e.updateLayoutForNode(l)}}]},{name:"Add Router",onSelect:()=>{const l=e.manager.addRouter();l.drawable.pos=c,e.updateLayoutForNode(l)}}],M=c=>{const l=e.manager.getNodeByID(c);let y=[{name:"Remove",onSelect:()=>{this.nm.removeNode(l)}}];switch(l.hasFreeConnector()&&e.isNodeSelected&&l.getNodeID()!==e.getSelectedNode.getNodeID()?y.push({name:"Add Link to selected",onSelect:()=>{try{e.manager.addLink(l,e.getSelectedNode)}catch(v){t.error(v.message)}}}):l.getNodeType()!==N.Switch&&l.connectors.filter(v=>v.isConnected()).forEach(v=>{y.push({name:`Disconnect ${v.id}`,onSelect:()=>{const k=v.link;e.manager.removeLink(k)}})}),l==null?void 0:l.getNodeType()){case N.Switch:y.push({name:"Show MacTable",onSelect:()=>{console.warn("not implemented")}});break;case N.Host:y.push({name:"Edit",onSelect:()=>{e.setEditNode(l.getNodeID())}}),y.push({name:"ShowTerminal",onSelect:()=>{e.setTermCtxID(l.getNodeID()),e.terminal.show=!0}}),y.push({name:"send DHCP discover",onSelect:()=>{l.getDynamicIpConfig()}}),e.isNodeSelected&&e.getSelectedNode.isHost()&&y.push({name:"ping selected Node",onSelect:()=>{l.ping(e.getSelectedNode.getIpAddr())}});break;case N.Router:y.push({name:"Edit",onSelect:()=>{e.setEditNode(l.getNodeID())}});break;default:console.warn("Unknown NodeType error");break}return y},b=c=>[{name:"Remove",onSelect:()=>{e.manager.removeLink(e.manager.getLinkByID(c))}}],w={"node:click":c=>{p.show=!1,console.log("Node",c.node,"clicked")},"node:dragend":c=>{for(const l in c)e.moveNode(l,c[l])},"node:contextmenu":_,"edge:contextmenu":S,"view:contextmenu":A,"view:click":()=>{p.show=!1,a.value.close()}},L=[{name:"Remove selected",onSelect:()=>{for(const c of e.selected.nodes)e.manager.removeNodeWithID(c);for(const c of e.selected.links)e.manager.removeLinkWithID(c);t.warning("All selected nodes removed.")}},{name:"Open Recent",onSelect:()=>{e.loadRecentNetwork(),t.success("Network loaded")}},{name:"Save Network",onSelect:()=>{e.saveNetwork(),t.success("Network saved")}},{name:"Save As File",onSelect:()=>{e.saveNetworkAsFile()}},{name:"Export Graph as SVG",onSelect:()=>{if(!n.value){const c=n.value.getAsSvg(),l=URL.createObjectURL(new Blob([c],{type:"octet/stream"})),y=document.createElement("a");y.href=l,y.download="network-graph.svg",y.click(),window.URL.revokeObjectURL(l)}}},{name:"Reset",onSelect:()=>{e.reset(),t.success("Network reset")}}],Q=he(Te({view:{panEnabled:!0,zoomEnabled:!0,scalingObjects:!0,grid:{visible:!0}},node:{draggable:!0,selectable:r,normal:{radius:26,width:60,height:30,type:c=>c.dType,color:c=>c.color},hover:{color:c=>c.color},label:{direction:"center",color:"#ffffff"}},edge:{selectable:!0,normal:{color:c=>c.animate?re.active:re.idle,dasharray:c=>c.animate?"4":"0",animate:c=>!!c.animate,linecap:"round"},marker:{source:{type:c=>{var l;return(l=c[0].srcmarker)!=null?l:"none"}},target:{type:c=>{var l;return(l=c[0].tarmarker)!=null?l:"none"}}}}})),q={msg:"paths",batches:"nodes"},Z=c=>{const l=c.c1.owner,y=c.c2.owner,v=l.drawable.pos,k=y.drawable.pos;return{x:v.x+(k.x-v.x)*.5,y:v.y+(k.y-v.y)*.5}};return(c,l)=>{const y=Ne("v-network-graph");return h(),u(E,null,[f(y,{ref_key:"graphRef",ref:n,"selected-nodes":d(e).selected.nodes,"onUpdate:selected-nodes":l[0]||(l[0]=v=>d(e).selected.nodes=v),"selected-edges":d(e).selected.links,"onUpdate:selected-edges":l[1]||(l[1]=v=>d(e).selected.links=v),nodes:d(e).getNodes,edges:d(e).getEdges,layouts:d(e).layouts,configs:d(Q),"event-handlers":w,layers:q},Fe({batches:F(({scale:v})=>[(h(!0),u(E,null,K(d(e).manager.getAllHosts(),k=>(h(),u("svg",{key:k.id,x:k.drawable.pos.x-20*v,y:k.drawable.pos.y-40*v},[Ps,i("text",Rs,P(k.getCIDR()),1)],8,Ds))),128))]),_:2},[q.msg?{name:"msg",fn:F(({scale:v})=>[(h(!0),u(E,null,K(d(e).getActiveLinks,k=>(h(),u("svg",{key:k.id,x:Z(k).x*v,y:Z(k).y*v},[Ms,i("text",$s,P(k.lastFrame.getTypeLabel()),1),i("title",null,P(k.lastFrame),1)],8,Ss))),128))])}:void 0]),1032,["selected-nodes","selected-edges","nodes","edges","layouts","configs"]),d(p).show?(h(),xe(ws,{key:0,ref_key:"contextMenuRef",ref:g,position:d(p).position,items:d(p).items,onClose:l[2]||(l[2]=v=>d(p).show=!1)},null,8,["position","items"])):B("",!0),f(As,{ref_key:"floatMenuRef",ref:a,"menu-items":L},null,512)],64)}}},Ls={ref:"floatMenuWrapper",class:"absolute right-0 top-2 w-60"},Hs={props:{position:Object},setup(s){return(e,t)=>(h(),u("div",Ls,[Ie(e.$slots,"default")],512))}},Ts={class:"flex flex-col gap-2 p-2 overflow-y-auto"},Fs=i("h3",{class:"font-bold"},"Node Settings:",-1),Es=i("span",null,"Name: ",-1),Bs=["placeholder","onKeyup"],Os={class:"flex flex-col gap-1"},Vs=i("span",null,"IP Config: ",-1),Us={class:"flex gap-1"},Ws=i("p",null,"Static:",-1),qs={class:"flex gap-1"},js=i("p",null,"Addr:",-1),Ks=["placeholder","onKeyup"],Gs={class:"flex gap-1"},Xs=i("p",null,"SNM:",-1),Js=["placeholder","onKeyup"],Ys={class:"flex gap-1"},Qs=i("p",null,"GW:",-1),Zs=["placeholder","onKeyup"],en={class:"flex gap-1"},tn=i("p",null,"DNS:",-1),sn=["placeholder","onKeyup"],nn={props:{node:{type:te,required:!0}},emits:["close"],setup(s,{emit:e}){const t=s;ke(()=>t.node,()=>r.value=o.value[0]);const n=D({get:()=>t.node.getName(),set:x=>t.node.setName(x)}),o=D(()=>t.node.getConnectorList()),r=C(o.value[0]),a=D({get:()=>t.node.getIpConfig(r.value),set:x=>t.node.setIpConfig(x,r.value)}),g=()=>{},p=()=>{e("close")};return(x,_)=>{var A,S,R,M,b;return h(),u("div",Ts,[i("div",{class:"flex justify-between"},[Fs,i("button",{class:"w-6 h-6 text-center align-middle bg-gray-600 text-white rounded-full",onClick:p}," x ")]),i("p",null,"ID: "+P(s.node.getNodeID()),1),i("div",null,[Es,T(i("input",{"onUpdate:modelValue":_[0]||(_[0]=w=>be(n)?n.value=w:null),placeholder:(A=d(n))!=null?A:"enter new host name",onKeyup:V(g,["enter"]),class:"rounded"},null,40,Bs),[[O,d(n)]])]),i("div",Os,[Vs,T(i("select",{"onUpdate:modelValue":_[1]||(_[1]=w=>r.value=w),class:"text-sm rounded"},[(h(!0),u(E,null,K(d(o),w=>(h(),u("option",{key:w},P(w),1))),128))],512),[[Ee,r.value]]),i("div",Us,[Ws,i("p",null,P(d(a).static),1)]),i("div",qs,[js,T(i("input",{"onUpdate:modelValue":_[2]||(_[2]=w=>d(a).addr=w),placeholder:(S=d(a).addr)!=null?S:"enter new ip addr",onKeyup:V(g,["enter"]),class:"rounded px-1 w-full"},null,40,Ks),[[O,d(a).addr,void 0,{trim:!0}]])]),i("div",Gs,[Xs,T(i("input",{"onUpdate:modelValue":_[3]||(_[3]=w=>d(a).snm=w),placeholder:(R=d(a).snm)!=null?R:"enter new snm",onKeyup:V(g,["enter"]),class:"rounded px-1 w-full"},null,40,Js),[[O,d(a).snm,void 0,{trim:!0}]])]),i("div",Ys,[Qs,T(i("input",{"onUpdate:modelValue":_[4]||(_[4]=w=>d(a).gw=w),placeholder:(M=d(a).gw)!=null?M:"enter new gateway",onKeyup:V(g,["enter"]),class:"rounded px-1 w-full"},null,40,Zs),[[O,d(a).gw,void 0,{trim:!0}]])]),i("div",en,[tn,T(i("input",{"onUpdate:modelValue":_[5]||(_[5]=w=>d(a).dns=w),placeholder:(b=d(a).dns)!=null?b:"enter new dns",onKeyup:V(g,["enter"]),class:"rounded px-1 w-full"},null,40,sn),[[O,d(a).dns,void 0,{trim:!0}]])])])])}}},on={class:"flex flex-col gap-2 items-center"},rn=i("h3",null,"Traffic controls:",-1),an={class:"flex gap-1"},ln={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512",width:"2.5em",height:"2.5em",class:"hover:bg-white rounded-full"},cn={key:0,d:`M256,0C114.617,0,0,114.615,0,256s114.617,256,256,256s256-114.615,256-256S397.383,0,256,0z M344.48,269.57l-128,80
	          c-2.59,1.617-5.535,2.43-8.48,2.43c-2.668,0-5.34-0.664-7.758-2.008C195.156,347.172,192,341.82,192,336V176
	          c0-5.82,3.156-11.172,8.242-13.992c5.086-2.836,11.305-2.664,16.238,0.422l128,80c4.676,2.93,7.52,8.055,7.52,13.57
	          S349.156,266.641,344.48,269.57z`,fill:"#3498db"},dn={key:1,d:`M256,0C114.617,0,0,114.615,0,256s114.617,256,256,256s256-114.615,256-256S397.383,0,256,0z M224,320
            c0,8.836-7.164,16-16,16h-32c-8.836,0-16-7.164-16-16V192c0-8.836,7.164-16,16-16h32c8.836,0,16,7.164,16,16V320z M352,320
            c0,8.836-7.164,16-16,16h-32c-8.836,0-16-7.164-16-16V192c0-8.836,7.164-16,16-16h32c8.836,0,16,7.164,16,16V320z`,fill:"#3498db"},hn=i("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512",width:"2.5em",height:"2.5em",class:"hover:bg-white rounded-full"},[i("path",{d:`M256,0C114.615,0,0,114.615,0,256s114.615,256,256,256s256-114.615,256-256S397.385,0,256,0z M280.875,269.313l-96,64
	C182.199,335.094,179.102,336,176,336c-2.59,0-5.184-0.625-7.551-1.891C163.246,331.32,160,325.898,160,320V192
	c0-5.898,3.246-11.32,8.449-14.109c5.203-2.773,11.516-2.484,16.426,0.797l96,64C285.328,245.656,288,250.648,288,256
	S285.328,266.344,280.875,269.313z M368,320c0,8.836-7.164,16-16,16h-16c-8.836,0-16-7.164-16-16V192c0-8.836,7.164-16,16-16h16
	c8.836,0,16,7.164,16,16V320z`,fill:"#e74c3c"})],-1),un=ee(" Next "),pn=[hn,un],gn={setup(s){const e=X().manager.tm,t=C(e.isPause()),n=C(),o=()=>{console.log("next step"),e.next()},r=()=>{t.value=!t.value,t.value?e.pause():e.play()},a=Be({get:()=>e.simulationTimeout,set:g=>e.setSimulationTimeout(g)});return(g,p)=>(h(),u("div",on,[rn,f(d(Oe),{modelValue:d(a),"onUpdate:modelValue":p[0]||(p[0]=x=>be(a)?a.value=x:null),min:250,max:2e3,step:250,height:7,tooltip:!0,tooltipText:"%v s"},null,8,["modelValue"]),i("div",an,[i("button",{ref_key:"pauseBtnRef",ref:n,class:"p-2 rounded font-bold text-white text-xl focus:outline-none",onClick:r},[(h(),u("svg",ln,[t.value?(h(),u("path",cn)):(h(),u("path",dn))])),ee(" "+P(t.value?"Play":"Pause"),1)],512),t.value?(h(),u("button",{key:0,class:"p-2 rounded font-bold text-white text-xl focus:outline-none",onClick:o},pn)):B("",!0)])]))}};const mn={id:"n-container",class:"flex flex-col items-stretch"},fn={key:0,class:"bg-gray-800 h-1/3"},vn={setup(s){const e=X(),t=D(()=>e.manager.getNodeByID(e.terminal.context.nodeID)),n=D(()=>e.manager.getNodeByID(e.nodeInfo.nodeID)),o=()=>{e.terminal.show=!1};return(r,a)=>(h(),u("div",mn,[i("div",{class:J(["relative bg-slate-100",d(e).isTerminalVisible?"h-2/3":"h-full"])},[f(qt,{class:"relative h-full"},{default:F(()=>[f(zs),d(e).nodeInfo.show?(h(),xe(Hs,{key:0,class:"bg-amber-400 rounded"},{default:F(()=>[f(nn,{node:d(n),onClose:a[0]||(a[0]=g=>d(e).nodeInfo.show=!1)},null,8,["node"])]),_:1})):B("",!0),f(gn,{class:"absolute top-10 left-20 bg-amber-400 rounded p-2"})]),_:1})],2),d(e).isTerminalVisible?(h(),u("div",fn,[f(is,{node:d(t),onClose:o},null,8,["node"])])):B("",!0)]))}};var ye=z(vn,[["__scopeId","data-v-0976efd6"]]);const wn=Ve({history:Ue("/network-sim/"),routes:[{path:"/",name:"home",component:ye},{path:"/network",name:"network",component:ye},{path:"/tutorial",name:"tutorial",component:()=>pe(()=>import("./Tutorial.9151dc7f.js"),["assets/Tutorial.9151dc7f.js","assets/vendor.5fd544b7.js"])},{path:"/about",name:"about",component:()=>pe(()=>import("./AboutView.d5ddf25a.js"),["assets/AboutView.d5ddf25a.js","assets/vendor.5fd544b7.js"])}]});const _n={timeout:1500},Y=We(Et);Y.use(qe());try{X().loadRecentNetwork()}catch(s){console.log("could not load network",s),X().reset()}Y.use(wn);Y.use(je);Y.use(Ke,_n);Y.mount("#app");export{qt as M};
